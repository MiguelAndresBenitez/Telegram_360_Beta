================================================================================
  TELEGRAM 360 - GUÃA PASO A PASO INSTALACIÃ“N EN CLOUDPANEL
================================================================================

PLATAFORMA: CloudPanel en Ubuntu 24.04
RECURSOS: 2 CPU, 4GB RAM
FECHA: Enero 2026
ESTADO: PRODUCCIÃ“N LISTA

================================================================================
PASO 0: PREPARACIÃ“N PREVIA (ANTES DE CONECTAR AL SERVIDOR)
================================================================================

1. Descargar el cÃ³digo del servidor:
   URL: https://github.com/MiguelAndresBenitez/Telegram_360_Beta
   OpciÃ³n A - Git: git clone https://github.com/MiguelAndresBenitez/Telegram_360_Beta.git
   OpciÃ³n B - ZIP: Descargar desde GitHub

2. Verificar archivos necesarios:
   âœ“ docker-compose.prod.yml
   âœ“ deploy/nginx.conf
   âœ“ deploy.sh
   âœ“ setup-https.sh
   âœ“ check-requirements.sh
   âœ“ CLIENT_CONFIGURATION.txt
   âœ“ .env.prod.example

3. Leer: CLIENT_CONFIGURATION.txt (5 minutos)
   - Entender quÃ© datos cambiar
   - Preparar datos del cliente

4. Obtener credenciales de Telegram:
   Pasos en CLIENT_CONFIGURATION.txt secciÃ³n "CREDENCIALES TELEGRAM"
   - Bot Token de @BotFather
   - API ID de https://my.telegram.org
   - API Hash de https://my.telegram.org

================================================================================
PASO 1: CONECTAR AL SERVIDOR (5 minutos)
================================================================================

En tu mÃ¡quina local:

$ ssh root@IP_DEL_SERVIDOR
# O con puerto custom
$ ssh -p 2222 root@IP_DEL_SERVIDOR

Si pide contraseÃ±a, introducir la del servidor CloudPanel.

Una vez conectado, verÃ¡s algo como:
root@servidor:~#

================================================================================
PASO 2: DESCARGAR EL CÃ“DIGO (2 minutos)
================================================================================

Una vez en el servidor (despuÃ©s de ssh):

root@servidor:~# mkdir -p /var/www
root@servidor:~# cd /var/www
root@servidor:/var/www# git clone https://github.com/MiguelAndresBenitez/Telegram_360_Beta.git telegram_360
root@servidor:/var/www# cd telegram_360
root@servidor:/var/www/telegram_360#

Ahora estÃ¡s en el directorio correcto con todo el cÃ³digo descargado.

================================================================================
PASO 3: VALIDAR REQUISITOS DEL SERVIDOR (3 minutos)
================================================================================

root@servidor:/var/www/telegram_360# chmod +x check-requirements.sh
root@servidor:/var/www/telegram_360# ./check-requirements.sh

Esperado: VerÃ¡s una lista de verificaciones en verde con el resultado:
âœ… Â¡SISTEMA LISTO PARA EL DESPLIEGUE!

Si hay errores (âŒ):
1. Leer el mensaje de error
2. Instalar lo que falte (el script te dice cÃ³mo)
3. Ejecutar de nuevo: ./check-requirements.sh

================================================================================
PASO 4: CONFIGURAR VARIABLES DE ENTORNO (10 minutos)
================================================================================

4.1 Crear archivo .env.prod:

root@servidor:/var/www/telegram_360# cp .env.prod.example .env.prod
root@servidor:/var/www/telegram_360# nano .env.prod

4.2 Editar en nano (peguÃ© el contenido de CLIENT_CONFIGURATION.txt):

Busca cada lÃ­nea que dice [CAMBIAR_POR_...] y reemplazala:

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DATABASE:
POSTGRES_USER=telegram_admin              ðŸ‘ˆ CAMBIAR: minegocio_admin
POSTGRES_PASSWORD=TuContraseÃ±aSegura123!  ðŸ‘ˆ CAMBIAR: Usar contraseÃ±a fuerte >15 chars

RABBITMQ:
RABBITMQ_USER=rabbitmq_admin              ðŸ‘ˆ CAMBIAR: minegocio_rabbit
RABBITMQ_PASSWORD=OtraContraseÃ±aSegura456! ðŸ‘ˆ CAMBIAR: Usar contraseÃ±a fuerte >15 chars

BACKEND:
BACKEND_URL=https://tudominio.com         ðŸ‘ˆ CAMBIAR: https://cliente.com
SECRET_KEY=tu-secret-key-super-seguro     ðŸ‘ˆ CAMBIAR: Generar aleatorio (30+ chars)

TELEGRAM:
TELEGRAM_BOT_TOKEN=123456:ABC-...         ðŸ‘ˆ CAMBIAR: Token obtenido de @BotFather
TELEGRAM_API_ID=1234567                   ðŸ‘ˆ CAMBIAR: ID de my.telegram.org
TELEGRAM_API_HASH=abcd1234567890efgh      ðŸ‘ˆ CAMBIAR: Hash de my.telegram.org

FRONTEND:
REACT_APP_API_URL=https://tudominio.com/api  ðŸ‘ˆ CAMBIAR: https://cliente.com/api

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

4.3 Guardar el archivo:

En nano:
Ctrl+X
Y (yes)
Enter

Verificar que se guardÃ³:
root@servidor:/var/www/telegram_360# cat .env.prod
# DeberÃ­as ver tus cambios reflejados

================================================================================
PASO 5: COMPILAR FRONTEND (10 minutos)
================================================================================

root@servidor:/var/www/telegram_360# cd dashboard
root@servidor:/var/www/telegram_360/dashboard# npm ci
root@servidor:/var/www/telegram_360/dashboard# npm run build

Espera a que termine (verÃ¡s "Build completed successfully" al final).

Verificar que se compilÃ³:
root@servidor:/var/www/telegram_360/dashboard# ls -la dist/
# DeberÃ­as ver archivos HTML, CSS, JS compilados

Volver a la carpeta raÃ­z:
root@servidor:/var/www/telegram_360/dashboard# cd ..

================================================================================
PASO 6: DESPLEGAR SERVICIOS CON DOCKER (10 minutos)
================================================================================

6.1 Validar configuraciÃ³n docker-compose:

root@servidor:/var/www/telegram_360# docker-compose -f docker-compose.prod.yml config
# DeberÃ­as ver el archivo sin errores

6.2 Levantar los servicios:

root@servidor:/var/www/telegram_360# docker-compose -f docker-compose.prod.yml up -d --build

Esto puede tomar 5-10 minutos en la primera vez (descargando imÃ¡genes).

6.3 Esperar a que todo inicie:

root@servidor:/var/www/telegram_360# sleep 30
root@servidor:/var/www/telegram_360# docker-compose -f docker-compose.prod.yml ps

Esperado (todos en estado "Up"):
NAME          STATE
db            Up (healthy)
redis         Up (healthy)
rabbitmq      Up
backend       Up (healthy)
workers       Up
frontend      Up

Si algo estÃ¡ "Restarting" o "Exit" espera 30s mÃ¡s y verifica de nuevo.

================================================================================
PASO 7: VERIFICAR QUE FUNCIONA (5 minutos)
================================================================================

7.1 Verificar que la BD estÃ¡ conectada:

root@servidor:/var/www/telegram_360# docker-compose -f docker-compose.prod.yml exec db psql -U postgres -d plataforma_canales -c "SELECT 1;"
# Esperado: (1 row) con "1"

7.2 Verificar Redis:

root@servidor:/var/www/telegram_360# docker-compose -f docker-compose.prod.yml exec redis redis-cli ping
# Esperado: PONG

7.3 Verificar API:

root@servidor:/var/www/telegram_360# curl -s http://localhost/api/docs | head -20
# DeberÃ­as ver HTML de Swagger docs

7.4 Verificar Frontend:

En navegador: http://IP_DEL_SERVIDOR o http://dominio.com
# DeberÃ­as ver la interfaz del dashboard

================================================================================
PASO 8: CONFIGURAR HTTPS CON LET'S ENCRYPT (10 minutos)
================================================================================

âš ï¸ IMPORTANTE: El dominio debe apuntar al servidor ANTES de este paso.

8.1 Verificar DNS:

root@servidor:/var/www/telegram_360# nslookup cliente.com
# Debe resolver a la IP del servidor

8.2 Configurar HTTPS automÃ¡ticamente:

root@servidor:/var/www/telegram_360# bash setup-https.sh cliente.com admin@cliente.com

Sigue los pasos que pide (generalmente solo Enter para aceptar tÃ©rminos).

Esperado: "âœ… HTTPS configurado"

8.3 Verificar en navegador:

https://cliente.com
# DeberÃ­as ver el sitio con cerrado de seguridad verde

================================================================================
PASO 9: BACKUP Y DOCUMENTACIÃ“N (5 minutos)
================================================================================

9.1 Guardar credenciales del cliente en lugar seguro:

Crear documento con:
- Usuario/contraseÃ±a SSH
- Usuario/contraseÃ±a PostgreSQL
- Usuario/contraseÃ±a RabbitMQ
- Token Telegram Bot
- API ID y Hash
- URLs de acceso

9.2 Hacer backup de configuraciÃ³n:

root@servidor:/var/www/telegram_360# mkdir -p ~/backups
root@servidor:/var/www/telegram_360# cp .env.prod ~/backups/.env.prod.$(date +%Y%m%d)
root@servidor:/var/www/telegram_360# cp deploy/nginx.conf ~/backups/nginx.conf.$(date +%Y%m%d)

9.3 VerificaciÃ³n final de logs:

root@servidor:/var/www/telegram_360# docker-compose -f docker-compose.prod.yml logs --tail=50 backend
# DeberÃ­as ver logs sin errores crÃ­ticos

================================================================================
PASO 10: MONITOREO POST-INSTALACIÃ“N (Semanal)
================================================================================

Comandos para revisar regularmente:

# Ver estado de servicios
docker-compose -f docker-compose.prod.yml ps

# Ver uso de memoria/CPU
docker stats

# Ver logs de errores
docker-compose -f docker-compose.prod.yml logs --tail=100 backend

# Verificar espacio en disco
df -h

# Backup de base de datos (ejecutar cada semana)
docker-compose -f docker-compose.prod.yml exec db pg_dump -U postgres plataforma_canales > ~/backups/backup_$(date +%Y%m%d_%H%M%S).sql

================================================================================
TROUBLESHOOTING RÃPIDO
================================================================================

Problema: "docker-compose: command not found"
SoluciÃ³n: Usar "docker compose" en lugar de "docker-compose"
  root@servidor# docker compose -f docker-compose.prod.yml ps

Problema: "Port 80 already in use"
SoluciÃ³n: Detener Apache u otro servicio
  root@servidor# sudo systemctl stop apache2
  root@servidor# sudo systemctl disable apache2

Problema: "Out of memory"
SoluciÃ³n: Reducir workers en docker-compose.prod.yml
  Cambiar: command: uvicorn routes:app --host 0.0.0.0 --port 8000 --workers 2
  Por: command: uvicorn routes:app --host 0.0.0.0 --port 8000 --workers 1

Problema: "Connection refused" a PostgreSQL
SoluciÃ³n: Esperar a que BD inicie y reiniciar
  root@servidor# sleep 60
  root@servidor# docker-compose -f docker-compose.prod.yml restart db

Problema: "502 Bad Gateway"
SoluciÃ³n: Verificar logs del backend
  root@servidor# docker-compose -f docker-compose.prod.yml logs -f backend

Problema: HTTPS no funciona (conexiÃ³n no segura)
SoluciÃ³n: Verificar que setup-https.sh se completÃ³ sin errores
  root@servidor# sudo certbot certificates
  # Debe mostrar tu certificado

================================================================================
URLS DE ACCESO FINAL
================================================================================

Frontend (Dashboard):
  http://cliente.com (HTTP)
  https://cliente.com (HTTPS) âœ“ USAR ESTA

API Documentation:
  https://cliente.com/api/docs

RabbitMQ Admin (opcional, solo para debugging):
  http://cliente.com:15672
  Usuario: rabbitmq_admin (o el que configuraste)
  ContraseÃ±a: (la que configuraste)

Database (SSH tunnel):
  localhost:5432
  Usuario: minegocio_admin (o el que configuraste)
  Base: plataforma_canales

================================================================================
COMANDOS MÃS ÃšTILES (Copiar y pegar)
================================================================================

Ver estado de todo:
docker-compose -f docker-compose.prod.yml ps

Ver logs en tiempo real del backend:
docker-compose -f docker-compose.prod.yml logs -f backend

Ver logs de los workers:
docker-compose -f docker-compose.prod.yml logs -f workers

Ver uso de recursos:
docker stats

Entrar a shell del backend:
docker-compose -f docker-compose.prod.yml exec backend bash

Ejecutar comando en la BD:
docker-compose -f docker-compose.prod.yml exec db psql -U postgres -d plataforma_canales -c "SELECT * FROM usuarios LIMIT 5;"

Reiniciar un servicio:
docker-compose -f docker-compose.prod.yml restart backend

Detener todo:
docker-compose -f docker-compose.prod.yml down

Volver a levantar (despuÃ©s de detener):
docker-compose -f docker-compose.prod.yml up -d

Ver certificado HTTPS:
sudo certbot certificates

Renovar certificado HTTPS:
sudo certbot renew --dry-run

Hacer backup completo de BD:
docker-compose -f docker-compose.prod.yml exec db pg_dump -U postgres plataforma_canales > backup_completo_$(date +%Y%m%d).sql

Ver espacio en disco:
df -h

Ver usuario de SSH/contraseÃ±a actual:
cat /etc/passwd | grep -E "root|sudo"

================================================================================
CHECKLIST FINAL - ANTES DE ENTREGAR AL CLIENTE
================================================================================

âœ“ Todos los pasos 1-10 completados
âœ“ VerificaciÃ³n en navegador: https://cliente.com carga correctamente
âœ“ API docs accesible: https://cliente.com/api/docs
âœ“ HTTPS funcionando (candado verde en navegador)
âœ“ Certificado vÃ¡lido por >1 aÃ±o
âœ“ Base de datos con datos del cliente (si aplica)
âœ“ Telegram bot conectado y funcionando
âœ“ Workers de Telegram procesando correctamente
âœ“ Sistema monitoreado (cron jobs para backups)
âœ“ Credenciales guardadas en lugar seguro
âœ“ DocumentaciÃ³n de acceso entregada al cliente
âœ“ Contacto de soporte establecido
âœ“ Plan de backups diarios implementado
âœ“ Alertas/monitoreo configuradas
âœ“ Dashboard del cliente funcionando

================================================================================
DESPUÃ‰S DE LA INSTALACIÃ“N
================================================================================

OperaciÃ³n Diaria:
1. Revisar logs cada maÃ±ana
2. Monitorear uso de recursos
3. Responder a incidentes

Semanal:
1. Hacer backup de BD
2. Revisar logs de errores
3. Verificar certificados HTTPS

Mensual:
1. Limpiar datos antiguos (si aplica)
2. Optimizar BD
3. Revisar actualizaciones de Docker

Anual:
1. Renovar certificados HTTPS (automÃ¡tico con cron)
2. Hacer revisiÃ³n de seguridad
3. Actualizar documentaciÃ³n

================================================================================
FIN DE LA INSTALACIÃ“N
================================================================================

Tiempo total estimado: 45-60 minutos
PrÃ³ximos pasos: Entregar acceso al cliente y documentaciÃ³n

Soporte:
- Contacto tÃ©cnico: [TU CONTACTO]
- DocumentaciÃ³n: Ver archivos *.md en /var/www/telegram_360
- Problemas: Ver secciÃ³n TROUBLESHOOTING o logs

Â¡Sistema instalado y listo para usar! ðŸš€

================================================================================
